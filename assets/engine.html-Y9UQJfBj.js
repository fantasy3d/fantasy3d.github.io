import{_ as t}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as p,o as i,c,d as s,e as n,f as o,w as l,g as a}from"./app-WClEFZq0.js";const u={},r=a(`<p><a href="/api/classes/core_src.Engine.html">Engine</a> 作为 Fantasy 3D 的大脑，主要负责管理场景渲染。</p><h2 id="初始化" tabindex="-1"><a class="header-anchor" href="#初始化" aria-hidden="true">#</a> 初始化</h2><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Engine <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@fantasy3d/core&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 创建引擎</span>
<span class="token keyword">const</span> engine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Engine</span><span class="token punctuation">(</span> <span class="token punctuation">{</span>

  <span class="token comment">// WebGL Options</span>
  gl<span class="token operator">:</span> <span class="token punctuation">{</span>

    <span class="token comment">// 渲染视口</span>
    viewport<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span> <span class="token string">&#39;viewport&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>
    clearColor<span class="token operator">:</span> <span class="token string">&#39;rgb( 36, 44, 49 )&#39;</span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">提示</p><p>Engine 初始化参数详见 <a href="/api/interfaces/core_src.EngineOptions.html">EngineOptions</a>，<a href="/api/interfaces/core_src.WebGLOptions.html">WebGLOptions</a> 继承自 three.js 的 <a href="https://threejs.org/docs/index.html?q=WebGLRender#api/en/renderers/WebGLRenderer">WebGLRendererParameters</a>。</p></div><h2 id="属性" tabindex="-1"><a class="header-anchor" href="#属性" aria-hidden="true">#</a> 属性</h2>`,5),d=s("a",{href:"/api/classes/core_src.Engine.html#resourceManager"},"resourceManager",-1),k=s("strong",null,"只读",-1),v=a(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> resourceManager <span class="token punctuation">}</span> <span class="token operator">=</span> engine<span class="token punctuation">;</span>

<span class="token comment">// 加载文件资源</span>
resourceManager<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span> <span class="token string">&#39;./assets/files/a.josn&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> data <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:加载完成回调</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载纹理资源</span>
resourceManager<span class="token punctuation">.</span><span class="token function">loadTexture</span><span class="token punctuation">(</span> <span class="token string">&#39;./assets/textures/diffuse.png&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> resource <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:加载完成回调</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载glb资源</span>
resourceManager<span class="token punctuation">.</span><span class="token function">loadGLTF</span><span class="token punctuation">(</span> <span class="token string">&#39;./assets/models/car.glb&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> resource <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:加载完成回调</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载音频资源</span>
resourceManager<span class="token punctuation">.</span><span class="token function">loadAudio</span><span class="token punctuation">(</span> <span class="token string">&#39;./assets/audios/alarm.wav&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> resource <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:加载完成回调</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p><a href="/api/classes/core_src.Engine.html#uniformsLib">uniformsLib</a> - 提供Shader通用Uniform，详见 <a href="/api/classes/core_src.UniformsLib.html">UniformsLib</a>，<strong>只读</strong>属性。</p></li><li><p><a href="/api/classes/core_src.Engine.html#gl">gl</a> - WebGL渲染器，详见 <a href="https://threejs.org/docs/index.html?q=WebG#api/zh/renderers/WebGLRenderer">WebGLRenderer</a>，<strong>只读</strong>属性。</p></li><li><p><a href="/api/classes/core_src.Engine.html#customRenderScenes">customRenderScenes</a> - 定制场景渲染方法。</p></li></ul><div class="hint-container tip"><p class="hint-container-title">提示</p><p>通常每帧循环时，引擎会依次渲染所有激活场景。通过&#39;customRenderScenes&#39;可以定制场景渲染逻辑。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>engine<span class="token punctuation">.</span><span class="token function-variable function">customRenderScenes</span> <span class="token operator">=</span> <span class="token punctuation">(</span> scenes<span class="token operator">:</span> Scene<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> options<span class="token operator">:</span> RenderOptions <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:定制场景渲染逻辑</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><h2 id="方法" tabindex="-1"><a class="header-anchor" href="#方法" aria-hidden="true">#</a> 方法</h2><ul><li><a href="/api/classes/core_src.Engine.html#dispose">dispose</a> - 释放引擎，释放所有渲染对象以及渲染资源。</li></ul><h2 id="事件" tabindex="-1"><a class="header-anchor" href="#事件" aria-hidden="true">#</a> 事件</h2><ul><li><a href="/api/classes/core_src.Engine.html#on">on</a> - 订阅事件。</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@fantasy3d/core&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 订阅“帧循环开始”事件</span>
engine<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:事件响应</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="/api/classes/core_src.Engine.html#once">once</a> - 订阅事件且仅响应一次。</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@fantasy3d/core&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 订阅一次“帧循环开始”事件</span>
engine<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

  <span class="token comment">// TODO:事件响应</span>

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="/api/classes/core_src.Engine.html#off">off</a> - 取消事件订阅。</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@fantasy3d/core&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// “帧循环开始”事件订阅回调</span>
<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 订阅“帧循环开始”事件</span>
engine<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token punctuation">{</span> target<span class="token operator">:</span> <span class="token keyword">this</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 取消订阅“帧循环开始”事件</span>
engine<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span><span class="token punctuation">,</span> callback <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container important"><p class="hint-container-title">重要</p><p>“取消订阅”时如果不设置第二个参数，会取消该类型事件的所有订阅！</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 取消“帧循环开始”事件的所有订阅</span>
engine<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><ul><li><a href="/api/classes/core_src.Engine.html#emit">emit</a> - 分发事件。</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> EventType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@fantasy3d/core&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// 分发“帧循环开始”事件</span>
engine<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span> <span class="token punctuation">{</span>

  type<span class="token operator">:</span> EventType<span class="token punctuation">.</span><span class="token constant">BEFORE_FRAME_LOOP</span><span class="token punctuation">,</span>
  timeSinceLastFrame<span class="token punctuation">,</span>
  totalTime

<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>内置事件</li></ul><table><thead><tr><th style="text-align:left;">事件类型</th><th style="text-align:left;">事件说明</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>BEFORE_FRAME_LOOP</strong></td><td style="text-align:left;">帧循环开始事件，每帧渲染循环开始时触发</td></tr><tr><td style="text-align:left;"><strong>BEFORE_SCENES_RENDER</strong></td><td style="text-align:left;">场景开始渲染事件，所有场景渲染之前触发</td></tr><tr><td style="text-align:left;"><strong>BEFORE_SCENE_RENDER</strong></td><td style="text-align:left;">场景开始渲染事件，单个场景渲染之前触发</td></tr><tr><td style="text-align:left;"><strong>AFTER_SCENE_RENDER</strong></td><td style="text-align:left;">场景结束渲染事件，单个场景渲染之后触发</td></tr><tr><td style="text-align:left;"><strong>AFTER_SCENES_RENDER</strong></td><td style="text-align:left;">场景结束渲染事件，所有场景渲染之后触发</td></tr><tr><td style="text-align:left;"><strong>AFTER_FRAME_LOOP</strong></td><td style="text-align:left;">帧循环结束事件，每帧渲染循环结束时触发</td></tr></tbody></table>`,17);function m(b,g){const e=p("RouterLink");return i(),c("div",null,[r,s("ul",null,[s("li",null,[d,n(" - 资源管理器，用于加载文件、纹理、gltf、glb加载，详细说明请参考“"),o(e,{to:"/guide/basic/resource.html"},{default:l(()=>[n("资源")]),_:1}),n("”，"),k,n("属性。")])]),v])}const E=t(u,[["render",m],["__file","engine.html.vue"]]);export{E as default};
