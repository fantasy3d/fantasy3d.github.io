<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title>Fantasy 3D Scene Background</title>
		<style>
			html {
				height: 100%;
			}
	
			body
			{
				font-family: Monospace;
				font-weight: bold;
				margin: 0px;
				height: 100%;
				overflow: hidden;
			}

            #gui_container{
				position: absolute;
				top: 1%;
				left: 45%;
			}

			#gui{
				transform:translate(-50%, -60px);
			}
		</style>
	</head>
	<body>
        <div id="gui_container"></div>
		<div id="viewport" style="width:100%; height:100%"></div>
		<script src='./js/libs/stats.min.js'></script>
        <script src="./js/loadscripts.js"></script>
        <script>loadscripts( { 
            
            "@fantasy3d/core": "../dist/fantasy.core.js"
            
        } )</script>
		<script type="module">

            import { Pane } from './js/libs/tweakpane-4.0.3.min.js';
            import { UVMapping, Vector3 } from 'three';
            import { Engine, EventType, Scene, SceneRenderer } from '@fantasy3d/core';

            // Create ui
            const pane = new Pane( { container: document.getElementById( 'gui_container' ), title: 'options', expanded: false } );

            // Create stats
            const stats = new Stats();
            document.body.appendChild( stats.dom );

            // Create engine
            const engine = new Engine( {

                // WebGL options
                gl: {

                    viewport: document.getElementById( 'viewport' ),
                    clearColor: '#171717'

                }

            } );

            // Update stats
            engine.on( EventType.BEFORE_FRAME, () => {

                stats.update();

            } );

            // Create scene
            const scene = new Scene( engine, {

                background: { url: './assets/textures/hdr/equirectangular/venice_sunset_1k.hdr' }

            } );

            // Set scene renderer
            scene.sceneRenderer = new SceneRenderer( engine );

            // Active scene
            scene.isActive = true;

            // Create a perspective camera
            const camera = scene.createPerspectiveCamera( {

                transform: { position: new Vector3( 0.0, 0.0, 10.0 ) },
                camera: { near: 0.1, far: 100.0 }

            } );

            // Set ui
            let currentUrl = './assets/textures/hdr/equirectangular/venice_sunset_1k.hdr';
            let currentColor = '#171717'; 

            pane.addBlade( {

                view: 'list',
                label: 'type',
                options: [
                    { text: 'Texture', value: 'Texture' },
                    { text: 'SolidColor', value: 'SolidColor' }
                ],
                value: 'Texture'

            } ).on( 'change', ( event ) => {

                const { value } = event;
                if ( value === 'Texture' ) {

                    textureBlade.hidden = false;
                    intensityBinding.hidden = false;
                    blurrinessBinding.hidden = false;
                    colorBinding.hidden = true;

                    scene.background = { url: currentUrl };

                } else {

                    textureBlade.hidden = true;
                    intensityBinding.hidden = true;
                    blurrinessBinding.hidden = true;
                    colorBinding.hidden = false;

                    scene.background = currentColor;

                }

            } );

            const textureBlade = pane.addBlade( {

                view: 'list',
                label: 'texture',
                options: [
                    { text: 'venice_sunset_1k', value: './assets/textures/hdr/equirectangular/venice_sunset_1k.hdr' },
                    { text: 'royal_esplanade_1k', value: './assets/textures/hdr/equirectangular/royal_esplanade_1k.hdr' }
                ],
                value: './assets/textures/hdr/equirectangular/venice_sunset_1k.hdr'

            } ).on( 'change', ( event ) => {

                const { value: url } = event;
                currentUrl = url;
                scene.background = { url };

            } );

            const intensityBinding = pane.addBinding( { intensity: 1.0 }, 'intensity', {

                min: 0,
                max: 1.0,
                step: 0.1

            } ).on( 'change', ( event ) => {

                const { value } = event;
                currentColor = value;
                scene.backgroundIntensity = value;

            } );

            const blurrinessBinding = pane.addBinding( { blurriness: 0.0 }, 'blurriness', {

                min: 0,
                max: 1.0,
                step: 0.1

            } ).on( 'change', ( event ) => {

                const { value } = event;
                scene.backgroundBlurriness = value;

            } );

            const colorBinding = pane.addBinding( { color: '#171717' }, 'color', {

                picker: 'inline',
                expanded: true

            } ).on( 'change', ( event ) => {

                const { value } = event;
                scene.background = value;

            } );
            colorBinding.hidden = true;

		</script>
	</body>
</html>
